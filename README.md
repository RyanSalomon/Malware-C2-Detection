# Malware-C2-Detection

## Objective

Today I'm tasked with monitoring network alerts.The objective is to triage an IDS/IPS alert to determine whether it is a true positive or a false positive. This involves analyzing the alert generated by an Intrusion Detection System (IDS) or Intrusion Prevention System (IPS) to understand the nature and context of the detected activity. The goal is to assess whether the alert indicates a legitimate security threat or if it is a benign event mistakenly flagged as malicious.

### Skills Learned

- Monitoring & Detection Skills.
- Proficiency in analyzing and interpreting network logs.
- Ability to generate and recognize attack signatures and patterns.
- Enhanced knowledge of network protocols and security vulnerabilities.
- Development of critical thinking and problem-solving skills in cybersecurity.

### Tools Used

- Brim.
- Network Miner.
- Wireshark.
- VirusTotal.

## Steps
Task 1: Identifying Malware Command and Control Activity

Procedure:

1.Open BRIM and navigate to the Queries tab on the left-hand side.

2.Select Suricata Alerts by Category and locate the alert titled Malware Command and Control Activity detected.

3.Right-click and select New search with this value to refine the search.

Visual: Multiple C2 activities in BRIM.

![image](https://github.com/user-attachments/assets/f28d0707-0679-4c2b-96b1-43e59ba689a8)  


![image](https://github.com/user-attachments/assets/d3b7f4b1-2094-4291-8378-3dc519178e97)  

Outcome: Upon investigation, multiple C2 activities were detected. By examining the alert details, the following signature was found:

1. Alert Signature: ET MALWARE MirrorBlast CnC Activity M3
2. Source IP: 169.239.128.11
3. Destination IP and Ports were also recorded.




Task 2: Attribution of the IP Address to a Threat Group

Procedure:

1. Use VirusTotal to inspect the flagged IP address (169.239.128.11).
2. Check the Community tab for details on threat attribution.
   
Outcome: The IP was found to be associated with TA505, a well-known cybercriminal group linked to the MirrorBlast malware family.

Visual: VirusTotal analysis showing IP linked to TA505 and MirrorBlast.

![image](https://github.com/user-attachments/assets/bb57a98d-9fcf-422c-b3e7-c3aa8e8e9b31)  
 



Task 3: Inspecting Web Traffic and Extracting User-Agent

Procedure:

1. In BRIM, navigate to the HTTP Requests section under the Queries tab.
2. Modify the query by adding user_agent to filter relevant traffic.

Visual: BRIM

![image](https://github.com/user-attachments/assets/7b0fa103-96a4-4215-9564-fad47099b2de)  

Outcome: The User-Agent was successfully extracted. Additionally, four other potentially malicious IP addresses were identified during the traffic inspection:

192.36.27.92
185.183.96.147
185.10.68.235 

![image](https://github.com/user-attachments/assets/cd3cc9ce-3185-494e-9c70-8c88d3050c2d)

After thoroughly examining each IP address on VirusTotal, I discovered that IPs 192.36.27.92, 185.183.96.147, and 185.10.68.235 are all flagged as malicious and associated with the TA505 group, suggesting that they are involved in the attack.

Visual: Example of malicious IPs identified via VirusTotal.

![image](https://github.com/user-attachments/assets/b47eb271-05f1-43e4-9285-013f452e4438)  

Task 4: Identifying Malicious Downloaded Files

Procedure:

1. Open NetworkMiner and inspect the FILES section to locate files associated with the malicious IP addresses.
   
Outcome: Several malicious files were detected, with their names logged for further analysis.

Visual: NetworkMiner, files section showing malicious files.

![image](https://github.com/user-attachments/assets/3364149b-ecfb-4cfe-96a3-fbf5c6871159)  


Task 5: Retrieving Full File Paths and File Names

Procedure:

For this task, I first attempted to find the file names using NetworkMiner, but it didn't provide the file paths or names. I then opened the pcap file in Wireshark and initially searched directly for "filter.msi," but it didn’t appear. Instead, I'll focus on searching for the malicious IP address associated with it. To do this, I used the following packet filter:
   
Outcome: Two files with their full file paths were identified:

C:\ProgramData\001\arab.bin
C:\ProgramData\001\arab.exe

Visual: Wireshark showing full file paths using Follow TCP Stream.

![image](https://github.com/user-attachments/assets/40b8e87a-4f6f-49c8-b103-dccb758e7f57)

This process was repeated for the remaining files.



For this task, I first attempted to find the file names using NetworkMiner, but it didn't provide the file paths or names. I then opened the pcap file in Wireshark and initially searched directly for "filter.msi," but it didn’t appear. Instead, I'll focus on searching for the malicious IP address associated with it. To do this, I used the following packet filter:

![image](https://github.com/user-attachments/assets/40b8e87a-4f6f-49c8-b103-dccb758e7f57) 

After locating the packet, I right-clicked and selected "Follow TCP Stream." I then scrolled to the bottom of the page to retrieve the file names and their paths.

![image](https://github.com/user-attachments/assets/e36dfc94-20a2-4e75-abaa-d8c28ca23fa7) ~Follow TCP Stream, Wireshark. The full file path of the directory and the name of the two files are C:\ProgramData\001\arab.bin, C:\ProgramData\001\arab.exe

To complete the task, I followed the same process for the remaining downloaded files.
















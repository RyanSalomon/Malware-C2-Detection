# Malware-C2-Detection

## Objective

Today I'm tasked with monitoring network alerts.The objective is to triage an IDS/IPS alert to determine whether it is a true positive or a false positive. This involves analyzing the alert generated by an Intrusion Detection System (IDS) or Intrusion Prevention System (IPS) to understand the nature and context of the detected activity. The goal is to assess whether the alert indicates a legitimate security threat or if it is a benign event mistakenly flagged as malicious.

### Skills Learned

- Monitoring & Detection Skills.
- Proficiency in analyzing and interpreting network logs.
- Ability to generate and recognize attack signatures and patterns.
- Enhanced knowledge of network protocols and security vulnerabilities.
- Development of critical thinking and problem-solving skills in cybersecurity.

### Tools Used

- Brim.
- Network Miner.
- Wireshark.
- VirusTotal.

## Steps
Project: Potentially Bad Traffic and Malware Command and Control Activity detected.

~TASK 1: Find the the alert signature for Malware command and control activity.

Open BRIM and scroll down on the left hand side in the Queries tab and double click on the “Suricata Alerts by Category” and then right click on "Malware Command and Control Activity detected" and “New search with this value”

![image](https://github.com/user-attachments/assets/f28d0707-0679-4c2b-96b1-43e59ba689a8)  ~ Multiple C2 activities detected in BRIM.

When double clicking on one of the alerts to open the log details, I can see the Alert Signature: ET MALWARE MirrorBlast CnC Activity M3.
I can also view the source and destination IP addresses and ports involved in the attack.

![image](https://github.com/user-attachments/assets/d3b7f4b1-2094-4291-8378-3dc519178e97)  ~ Brim Log Details

The attacker is using IP 169.239.128.11


~TASK 2: Find the threat group attributed to this IP address.
In the VirusTotal community tab, I found numerous references to both the group name and the malware family.

![image](https://github.com/user-attachments/assets/bb57a98d-9fcf-422c-b3e7-c3aa8e8e9b31)  ~ It is clear that this IP address is malicious, associated with the TA505 group, and linked to the MirrorBlast malware family.
 

~TASK 3: Inspect the web traffic for the flagged IP address; find the user-agent in the traffic.
In order to find the user-agent, I went back to Brim and navigated to the "HTTP requests" section under Queries on the left-hand side. Then edit the query in the search bar and add user_agent.

![image](https://github.com/user-attachments/assets/7b0fa103-96a4-4215-9564-fad47099b2de)  ~ user_agent on the right in BRIM.


While scrolling down the page, I identified four additional IP addresses that may be linked to the attack and could potentially be malicious. 

![image](https://github.com/user-attachments/assets/cd3cc9ce-3185-494e-9c70-8c88d3050c2d)

After thoroughly examining each IP address on VirusTotal, I discovered that IPs 192.36.27.92, 185.183.96.147, and 185.10.68.235 are all flagged as malicious and associated with the TA505 group, suggesting that they are involved in the attack.

![image](https://github.com/user-attachments/assets/b47eb271-05f1-43e4-9285-013f452e4438)  ~ Example of one of the malicious IP's found on VirusTotal.

~TASK 4: Find the file names of the downloaded files? 

In NetworkMiner, I identified the filenames associated with the malicious IP addresses.

![image](https://github.com/user-attachments/assets/3364149b-ecfb-4cfe-96a3-fbf5c6871159)  ~ NetworkMiner, under FILES


~TASK 5: Find the full file path of the directory and the name of the files.

For this task, I first attempted to find the file names using NetworkMiner, but it didn't provide the file paths or names. I then opened the pcap file in Wireshark and initially searched directly for "filter.msi," but it didn’t appear. Instead, I'll focus on searching for the malicious IP address associated with it. To do this, I used the following packet filter:

![image](https://github.com/user-attachments/assets/40b8e87a-4f6f-49c8-b103-dccb758e7f57) ~Wireshark

After locating the packet, I right-clicked and selected "Follow TCP Stream." I then scrolled to the bottom of the page to retrieve the file names and their paths.

![image](https://github.com/user-attachments/assets/e36dfc94-20a2-4e75-abaa-d8c28ca23fa7) ~Follow TCP Stream, Wireshark. The full file path of the directory and the name of the two files are C:\ProgramData\001\arab.bin, C:\ProgramData\001\arab.exe

To complete the task, I followed the same process for the remaining downloaded files.















